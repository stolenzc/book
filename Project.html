
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>项目 · NOTEBOOK</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="STOLENZC">
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-intopic-toc/style.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="PythonNote.html" />
    
    
    <link rel="prev" href="MysqlNote.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://stolenzc.github.io/blog" target="_blank" class="custom-link">博客主页</a>
        </li>
    
        
        <li>
            <a href="https://stolenzc.github.io/tools/json" target="_blank" class="custom-link">JSON TOOLS</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="AlgorithmNote.html">
            
                <a href="AlgorithmNote.html">
            
                    
                    算法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="DataAnalysis.html">
            
                <a href="DataAnalysis.html">
            
                    
                    数据分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="GoNote.html">
            
                <a href="GoNote.html">
            
                    
                    Go笔记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="JavaScriptNote.html">
            
                <a href="JavaScriptNote.html">
            
                    
                    前端
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="KubernetesNote.html">
            
                <a href="KubernetesNote.html">
            
                    
                    K8s
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="LinuxNote.html">
            
                <a href="LinuxNote.html">
            
                    
                    Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="MysqlNote.html">
            
                <a href="MysqlNote.html">
            
                    
                    MySQL
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.9" data-path="Project.html">
            
                <a href="Project.html">
            
                    
                    项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="PythonNote.html">
            
                <a href="PythonNote.html">
            
                    
                    Python基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="RedisNote.html">
            
                <a href="RedisNote.html">
            
                    
                    Redis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="SoftManual.html">
            
                <a href="SoftManual.html">
            
                    
                    软件使用
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >项目</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <a href="#&#x9879;&#x76EE;&#x5F00;&#x53D1;&#x6280;&#x672F;" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="&#x9879;&#x76EE;&#x5F00;&#x53D1;&#x6280;&#x672F;"><a name="&#x9879;&#x76EE;&#x5F00;&#x53D1;&#x6280;&#x672F;" class="anchor-navigation-ex-anchor" href="#&#x9879;&#x76EE;&#x5F00;&#x53D1;&#x6280;&#x672F;"><i class="fa fa-link" aria-hidden="true"></i></a>1. &#x9879;&#x76EE;&#x5F00;&#x53D1;&#x6280;&#x672F;</h1>
<h1 id="&#x4E00;-mysql&#x4E3B;&#x4ECE;&#x914D;&#x7F6E;"><a name="&#x4E00;-mysql&#x4E3B;&#x4ECE;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#&#x4E00;-mysql&#x4E3B;&#x4ECE;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>2. &#x4E00;. MySQL&#x4E3B;&#x4ECE;&#x914D;&#x7F6E;</h1>
<h2 id="1-&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x8BF4;&#x660E;"><a name="1-&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x8BF4;&#x660E;" class="anchor-navigation-ex-anchor" href="#1-&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x8BF4;&#x660E;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. 1. &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x8BF4;&#x660E;</h2>
<p>windows:<code>C:\ProgramData\MySQL\MySQL Server 5.7\my.ini</code></p>
<p>centos:<code>etc/my.cnf</code></p>
<h2 id="2-&#x4E3B;&#x673A;&#x914D;&#x7F6E;"><a name="2-&#x4E3B;&#x673A;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#2-&#x4E3B;&#x673A;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. 2. &#x4E3B;&#x673A;&#x914D;&#x7F6E;</h2>
<pre class="language-"><code>[mysqld]
server-id=200  &#x8BBE;&#x7F6E;&#x4E3B;&#x670D;&#x52A1;&#x5668;&#x7684;ID
innodb_flush_log_at_trx_commit=2  &#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5D29;&#x6E83;&#x6216;&#x8005;&#x7CFB;&#x7EDF;&#x65AD;&#x7535;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E0A;&#x4E00;&#x79D2;&#x949F;&#x6240;&#x6709;&#x4E8B;&#x52A1;&#x6570;&#x636E;&#x624D;&#x53EF;&#x80FD;&#x4E22;&#x5931;
sync_binlog=1  &#x5F00;&#x542F;binlog&#x65E5;&#x5FD7;&#x540C;&#x6B65;&#x529F;&#x80FD;
log-bin=mysql-bin-200  binlog&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x540D;
binlog-do-db=xxxx  # &#x8FD9;&#x4E2A;&#x8868;&#x793A;&#x53EA;&#x540C;&#x6B65;&#x67D0;&#x4E2A;&#x5E93; &#xFF08;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6B64;&#x9879;&#xFF0C;&#x8868;&#x793A;&#x540C;&#x6B65;&#x6240;&#x6709;&#x7684;&#x5E93;&#xFF09;
</code></pre><p>&#x91CD;&#x542F;mysql&#xFF1A;<code>service mysqld restart</code></p>
<p>&#x7ED9;&#x4ECE;&#x673A;&#x521B;&#x5EFA;&#x7528;&#x6237;&#x6388;&#x6743;&#xFF1A;</p>
<p><code>CREATE USER &apos;xiaoluo&apos;@&apos;10.7.185.99&apos; IDENTIFIED WITH mysql_native_password BY &apos;123456&apos;;</code></p>
<p><code>grant replication slave on *.* to &apos;mark&apos;@&apos;192.168.1.201&apos;;</code></p>
<p>&#x67E5;&#x770B;&#x4E3B;&#x673A;&#x5E93;&#x7684;&#x72B6;&#x6001;&#xFF1A;<code>show master status ;</code></p>
<h2 id="3-&#x914D;&#x7F6E;&#x4ECE;&#x673A;"><a name="3-&#x914D;&#x7F6E;&#x4ECE;&#x673A;" class="anchor-navigation-ex-anchor" href="#3-&#x914D;&#x7F6E;&#x4ECE;&#x673A;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3. 3. &#x914D;&#x7F6E;&#x4ECE;&#x673A;</h2>
<pre class="language-"><code>[mysqld]
server-id=201
innodb_flush_log_at_trx_commit=2
sync_binlog=1
log-bin=mysql-bin-201
</code></pre><p>&#x91CD;&#x542F;mysql&#xFF1A;<code>service mysqld restart</code></p>
<p>&#x8FDB;&#x5165;mysql&#x547D;&#x4EE4;&#x884C;&#xFF1A;</p>
<pre class="language-"><code>mysql&gt; change master to master_host=&apos;192.168.1.200&apos;, master_user=&apos;mark&apos;, master_password=&apos;123456&apos;, master_log_file=&apos;mysql-bin-200.000002&apos; ,master_log_pos=1167;
mysql&gt; start slave;  ##&#x5F00;&#x542F;&#x4ECE;&#x5E93;   (stop slave&#xFF1A;&#x5173;&#x95ED;&#x4ECE;&#x5E93;&#xFF09;
mysql&gt; show slave status\G; ###Slave_IO_Running,Slave_SQL_Running &#x90FD;&#x4E3A;Yes&#x7684;&#x65F6;&#x5019;&#x8868;&#x793A;&#x914D;&#x7F6E;&#x6210;&#x529F;
</code></pre><h2 id="4-django&#x4E0B;&#x5B9E;&#x73B0;&#x8BFB;&#x5199;&#x5206;&#x79BB;"><a name="4-django&#x4E0B;&#x5B9E;&#x73B0;&#x8BFB;&#x5199;&#x5206;&#x79BB;" class="anchor-navigation-ex-anchor" href="#4-django&#x4E0B;&#x5B9E;&#x73B0;&#x8BFB;&#x5199;&#x5206;&#x79BB;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4. 4. django&#x4E0B;&#x5B9E;&#x73B0;&#x8BFB;&#x5199;&#x5206;&#x79BB;</h2>
<p>&#x5728;&#x9879;&#x76EE;&#x4E0B;&#x7684;urls.py&#x6587;&#x4EF6;&#x540C;&#x7EA7;&#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;<code>database_router.py</code>&#x6587;&#x4EF6;</p>
<pre class="language-"><code class="lang-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf <span class="token keyword">import</span> settings
<span class="token keyword">import</span> random 

DATABASE_MAPPING <span class="token operator">=</span> settings<span class="token punctuation">.</span>DATABASE_APPS_MAPPING

<span class="token keyword">class</span> <span class="token class-name">DatabaseAppsRouter</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">db_for_read</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model<span class="token punctuation">,</span> <span class="token operator">**</span>hints<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;&quot;Point all read operations to the specific database.&quot;&quot;&quot;</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span>
        label <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>DATABASE_MAPPING<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span>
        <span class="token keyword">return</span> DATABASE_MAPPING<span class="token punctuation">[</span>label<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">db_for_write</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model<span class="token punctuation">,</span> <span class="token operator">**</span>hints<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;Point all write operations to the specific database.&quot;&quot;&quot;</span>
        <span class="token keyword">if</span> model<span class="token punctuation">.</span>_meta<span class="token punctuation">.</span>app_label <span class="token keyword">in</span> DATABASE_MAPPING<span class="token punctuation">:</span>
            <span class="token keyword">return</span> DATABASE_MAPPING<span class="token punctuation">[</span>model<span class="token punctuation">.</span>_meta<span class="token punctuation">.</span>app_label<span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">allow_relation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj1<span class="token punctuation">,</span> obj2<span class="token punctuation">,</span> <span class="token operator">**</span>hints<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;Allow any relation between apps that use the same database.&quot;&quot;&quot;</span>
        db_obj1 <span class="token operator">=</span> DATABASE_MAPPING<span class="token punctuation">.</span>get<span class="token punctuation">(</span>obj1<span class="token punctuation">.</span>_meta<span class="token punctuation">.</span>app_label<span class="token punctuation">)</span>
        db_obj2 <span class="token operator">=</span> DATABASE_MAPPING<span class="token punctuation">.</span>get<span class="token punctuation">(</span>obj2<span class="token punctuation">.</span>_meta<span class="token punctuation">.</span>app_label<span class="token punctuation">)</span>
        <span class="token keyword">if</span> db_obj1 <span class="token keyword">and</span> db_obj2<span class="token punctuation">:</span>
            <span class="token keyword">if</span> db_obj1 <span class="token operator">==</span> db_obj2<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>

    <span class="token comment"># for Django 1.4 - Django 1.6</span>
    <span class="token keyword">def</span> <span class="token function">allow_syncdb</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> db<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;Make sure that apps only appear in the related database.&quot;&quot;&quot;</span>

        <span class="token keyword">if</span> db <span class="token keyword">in</span> DATABASE_MAPPING<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> DATABASE_MAPPING<span class="token punctuation">.</span>get<span class="token punctuation">(</span>model<span class="token punctuation">.</span>_meta<span class="token punctuation">.</span>app_label<span class="token punctuation">)</span> <span class="token operator">==</span> db
        <span class="token keyword">elif</span> model<span class="token punctuation">.</span>_meta<span class="token punctuation">.</span>app_label <span class="token keyword">in</span> DATABASE_MAPPING<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>

    <span class="token comment"># Django 1.7 - Django 1.11</span>
    <span class="token keyword">def</span> <span class="token function">allow_migrate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> db<span class="token punctuation">,</span> app_label<span class="token punctuation">,</span> model_name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>hints<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> app_label<span class="token punctuation">,</span> model_name<span class="token punctuation">,</span> hints<span class="token punctuation">)</span>
        <span class="token keyword">if</span> db <span class="token keyword">in</span> DATABASE_MAPPING<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> DATABASE_MAPPING<span class="token punctuation">.</span>get<span class="token punctuation">(</span>app_label<span class="token punctuation">)</span> <span class="token operator">==</span> db
        <span class="token keyword">elif</span> app_label <span class="token keyword">in</span> DATABASE_MAPPING<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>
</code></pre>
<p>&#x5728;<code>settings.py</code>&#x6587;&#x4EF6;&#x4E2D;&#x6DFB;&#x52A0;&#xFF1A;</p>
<pre class="language-"><code class="lang-python">DATABASES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment"># &#x4E3B;&#x5E93; &#xFF08;&#x8BFB;&#x5199;&#x64CD;&#x4F5C; R/W)</span>
    <span class="token string">&apos;default&apos;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&apos;ENGINE&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;django.db.backends.mysql&apos;</span><span class="token punctuation">,</span>
        <span class="token string">&apos;NAME&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;test&apos;</span><span class="token punctuation">,</span>
        <span class="token string">&apos;USER&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;root&apos;</span><span class="token punctuation">,</span>
        <span class="token string">&apos;PASSWORD&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;1qaz2wsx&apos;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;HOST&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;10.7.185.71&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&apos;PORT&apos;</span><span class="token punctuation">:</span><span class="token string">&apos;&apos;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment"># &#x4ECE;&#x5E93; (&#x8BFB;&#x64CD;&#x4F5C; R)</span>
    <span class="token string">&apos;db2&apos;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&apos;ENGINE&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;django.db.backends.mysql&apos;</span><span class="token punctuation">,</span>
        <span class="token string">&apos;NAME&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;test&apos;</span><span class="token punctuation">,</span>
        <span class="token string">&apos;USER&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;root&apos;</span><span class="token punctuation">,</span>
        <span class="token string">&apos;PASSWORD&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;123456&apos;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;HOST&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;10.7.185.92&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&apos;PORT&apos;</span><span class="token punctuation">:</span><span class="token string">&apos;&apos;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

DATABASE_ROUTERS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&apos;&#x9879;&#x76EE;&#x540D;&#x79F0;.database_router.DatabaseAppsRouter&apos;</span><span class="token punctuation">]</span>
DATABASE_APPS_MAPPING <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&apos;hr_w&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;default&apos;</span><span class="token punctuation">,</span>
    <span class="token string">&apos;sales_w&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;default&apos;</span><span class="token punctuation">,</span>
    <span class="token string">&apos;hr_r&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;db2&apos;</span><span class="token punctuation">,</span>
    <span class="token string">&apos;sales_r&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;db2&apos;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x5728;&#x5E94;&#x7528;&#x7684;<code>module.py</code>&#x6587;&#x4EF6;&#x4E2D;&#x5B9A;&#x4E49;&#x6A21;&#x578B;&#x6700;&#x540E;&#x6DFB;&#x52A0;&#xFF1A;</p>
<pre class="language-"><code class="lang-python">    <span class="token comment"># &#x6307;&#x5B9A;&#x6A21;&#x578B;&#x521B;&#x5EFA;&#x5173;&#x8054;&#x7684;&#x6570;&#x636E;&#x5E93;</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        app_label <span class="token operator">=</span> <span class="token string">&apos;sales_w&apos;</span>
        db_table <span class="token operator">=</span> <span class="token string">&apos;game&apos;</span>
</code></pre>
<h1 id="django&#x90E8;&#x7F72;&#x4E0A;&#x7EBF;"><a name="django&#x90E8;&#x7F72;&#x4E0A;&#x7EBF;" class="anchor-navigation-ex-anchor" href="#django&#x90E8;&#x7F72;&#x4E0A;&#x7EBF;"><i class="fa fa-link" aria-hidden="true"></i></a>3. Django&#x90E8;&#x7F72;&#x4E0A;&#x7EBF;</h1>
<h2 id="1-&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;"><a name="1-&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;" class="anchor-navigation-ex-anchor" href="#1-&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1. 1. &#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</h2>
<p>&#x68C0;&#x67E5;&#x7A0B;&#x5E8F;&#xFF1A;<code>python manage.py check --deploy</code></p>
<p>&#x8C03;&#x8BD5;&#x76F8;&#x5173;&#xFF1A;</p>
<pre class="language-"><code class="lang-python">DEBUG <span class="token operator">=</span> <span class="token boolean">False</span>
ALLOWED_HOSTS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">]</span>
</code></pre>
<p>&#x5B89;&#x5168;&#x76F8;&#x5173;&#xFF1A;</p>
<pre class="language-"><code class="lang-python"><span class="token comment"># &#x4FDD;&#x6301;HTTPS&#x8FDE;&#x63A5;&#x7684;&#x65F6;&#x95F4;</span>
SECURE_HSTS_SECONDS <span class="token operator">=</span> <span class="token number">3600</span>
SECURE_HSTS_INCLUDE_SUBDOMAINS <span class="token operator">=</span> <span class="token boolean">True</span>
SECURE_HSTS_PRELOAD <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token comment"># &#x81EA;&#x52A8;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x5B89;&#x5168;&#x8FDE;&#x63A5;</span>
SECURE_SSL_REDIRECT <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token comment"># &#x907F;&#x514D;&#x6D4F;&#x89C8;&#x5668;&#x81EA;&#x4F5C;&#x806A;&#x660E;&#x63A8;&#x65AD;&#x5185;&#x5BB9;&#x7C7B;&#x578B;</span>
SECURE_CONTENT_TYPE_NOSNIFF <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token comment"># &#x907F;&#x514D;&#x8DE8;&#x7AD9;&#x811A;&#x672C;&#x653B;&#x51FB;</span>
SECURE_BROWSER_XSS_FILTER <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token comment"># COOKIE&#x53EA;&#x80FD;&#x901A;&#x8FC7;HTTPS&#x8FDB;&#x884C;&#x4F20;&#x8F93;</span>
SESSION_COOKIE_SECURE <span class="token operator">=</span> <span class="token boolean">True</span>
CSRF_COOKIE_SECURE <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token comment"># &#x9632;&#x6B62;&#x70B9;&#x51FB;&#x52AB;&#x6301;&#x653B;&#x51FB;&#x624B;&#x6BB5; - &#x4FEE;&#x6539;HTTP&#x534F;&#x8BAE;&#x54CD;&#x5E94;&#x5934;</span>
<span class="token comment"># &#x5F53;&#x524D;&#x7F51;&#x7AD9;&#x662F;&#x4E0D;&#x5141;&#x8BB8;&#x4F7F;&#x7528;&lt;iframe&gt;&#x6807;&#x7B7E;&#x8FDB;&#x884C;&#x52A0;&#x8F7D;&#x7684;</span>
X_FRAME_OPTIONS <span class="token operator">=</span> <span class="token string">&apos;DENY&apos;</span>
</code></pre>
<p>&#x654F;&#x611F;&#x4FE1;&#x606F;&#x653E;&#x5728;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x4E2D;&#xFF1A;</p>
<pre class="language-"><code class="lang-python">SECRET_KEY <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">&apos;SECRET_KEY&apos;</span><span class="token punctuation">]</span>

DB_USER <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">&apos;DB_USER&apos;</span><span class="token punctuation">]</span>
DB_PASS <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">&apos;DB_PASS&apos;</span><span class="token punctuation">]</span>

REDIS_AUTH <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">&apos;REDIS_AUTH&apos;</span><span class="token punctuation">]</span>
</code></pre>
<h2 id="2-&#x9879;&#x76EE;&#x7ED3;&#x6784;"><a name="2-&#x9879;&#x76EE;&#x7ED3;&#x6784;" class="anchor-navigation-ex-anchor" href="#2-&#x9879;&#x76EE;&#x7ED3;&#x6784;"><i class="fa fa-link" aria-hidden="true"></i></a>3.2. 2. &#x9879;&#x76EE;&#x7ED3;&#x6784;</h2>
<pre class="language-"><code>project
&#x251C;&#x2500;&#x2500; code
&#x2502;   &#x2514;&#x2500;&#x2500; fangtx
&#x2502;       &#x251C;&#x2500;&#x2500; api
&#x2502;       &#x251C;&#x2500;&#x2500; common
&#x2502;       &#x251C;&#x2500;&#x2500; fangtx
&#x2502;       &#x251C;&#x2500;&#x2500; forum
&#x2502;       &#x251C;&#x2500;&#x2500; rent
&#x2502;       &#x251C;&#x2500;&#x2500; user
&#x2502;       &#x251C;&#x2500;&#x2500; manage.py
&#x2502;       &#x251C;&#x2500;&#x2500; README.md
&#x2502;       &#x251C;&#x2500;&#x2500; static
&#x2502;       &#x2514;&#x2500;&#x2500; templates
&#x251C;&#x2500;&#x2500; conf
&#x2502;   &#x251C;&#x2500;&#x2500; cert
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; 214915882850706.key
&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; 214915882850706.pem
&#x2502;   &#x251C;&#x2500;&#x2500; nginx.conf
&#x2502;   &#x2514;&#x2500;&#x2500; uwsgi.ini
&#x251C;&#x2500;&#x2500; logs
&#x2502;   &#x251C;&#x2500;&#x2500; access.log
&#x2502;   &#x251C;&#x2500;&#x2500; error.log
&#x2502;   &#x2514;&#x2500;&#x2500; uwsgi.log
&#x251C;&#x2500;&#x2500; stat
&#x2502;   &#x2514;&#x2500;&#x2500; css
&#x2502;   &#x2514;&#x2500;&#x2500; images
&#x2502;   &#x2514;&#x2500;&#x2500; js
&#x2514;&#x2500;&#x2500; venv
</code></pre><blockquote>
<p>code&#x4E0B;&#x5B58;&#x653E;&#x9879;&#x76EE;&#x6E90;&#x7801;</p>
<p>conf&#x4E0B;&#x5B58;&#x653E;nginx&#x914D;&#x7F6E;&#x6587;&#x4EF6;</p>
<blockquote>
<p>cert&#x4E0B;&#x4E3A;https&#x7684;&#x8BA4;&#x8BC1;&#x8BC1;&#x4E66;</p>
</blockquote>
<p>logs&#x4E0B;&#x9762;&#x4E3A;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;</p>
<p>stat&#x4E0B;&#x4E3A;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x5939;</p>
<p>venv&#x4E0B;&#x4E3A;&#x865A;&#x62DF;&#x73AF;&#x5883;</p>
</blockquote>
<p>&#x914D;&#x7F6E;ssl&#xFF1A;</p>
<p>&#x7F16;&#x8F91;<code>nginx.conf</code>:</p>
<pre class="language-"><code>server {
    listen       443 ssl http2 default_server;
    listen       [::]:443 ssl http2 default_server;
    server_name  _;
    root         /usr/share/nginx/html;

    ssl_session_cache shared:SSL:1m;
    ssl_certificate cert/a.pem;   #&#x5C06;domain name.pem&#x66FF;&#x6362;&#x6210;&#x60A8;&#x8BC1;&#x4E66;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x3002;
    ssl_certificate_key cert/b.key;   #&#x5C06;domain name.key&#x66FF;&#x6362;&#x6210;&#x60A8;&#x8BC1;&#x4E66;&#x7684;&#x5BC6;&#x94A5;&#x6587;&#x4EF6;&#x540D;&#x3002;
    ssl_session_timeout 5m;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;  #&#x4F7F;&#x7528;&#x6B64;&#x52A0;&#x5BC6;&#x5957;&#x4EF6;&#x3002;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;   #&#x4F7F;&#x7528;&#x8BE5;&#x534F;&#x8BAE;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x3002;
    ssl_prefer_server_ciphers on;
    # Load configuration files for the default server block.
    include /etc/nginx/default.d/*.conf;
    location / {
        root /home/nginxHTML;
        index index.html index.htm;
    }

    error_page 404 /404.html;
        location = /40x.html {
        }

    error_page 500 502 503 504 /50x.html;
        location = /50x.html {
        }
    }
</code></pre><blockquote>
<p>&#x5728;80&#x7AEF;&#x53E3;&#x4E66;&#x5199;<code>rewrite ^(.*)$ https://$host$1 permanent;</code>&#x53EF;&#x4EE5;&#x5C06;http&#x7684;&#x8BBF;&#x95EE;&#x8F6C;&#x53D1;&#x5230;https&#x4E2D;&#x53BB;</p>
</blockquote>
<p>&#x5728;django&#x7684;<code>manager.py</code>&#x76EE;&#x5F55;&#x540C;&#x7EA7;&#x4E0B;&#x521B;&#x5EFA;<code>uwsgi.ini</code>&#x6587;&#x4EF6;</p>
<pre class="language-"><code>

</code></pre><p>&#x5173;&#x95ED;uwsgi&#x8FDB;&#x7A0B;&#x547D;&#x4EE4;:<code>pkill -f uwsgi -9</code></p>
<p>&#x542F;&#x52A8;uwsgi&#x8FDB;&#x51FA;&#x547D;&#x4EE4;:<code>uwsgi --ini uwsgi.ini &amp;</code></p>
<p>&#x91CD;&#x542F;nginx:<code>systemctl restart nginx</code> </p>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; book.stolenzc.com 2021-2022 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">File Modify: 
2022-03-27 15:39:57
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="MysqlNote.html" class="navigation navigation-prev " aria-label="Previous page: MySQL">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="PythonNote.html" class="navigation navigation-next " aria-label="Next page: Python基础">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"项目","level":"1.9","depth":1,"next":{"title":"Python基础","level":"1.10","depth":1,"path":"PythonNote.md","ref":"PythonNote.md","articles":[]},"previous":{"title":"MySQL","level":"1.8","depth":1,"path":"MysqlNote.md","ref":"MysqlNote.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-lunr","-search","-sharing","search-pro","splitter","code","github","-highlight","prism","anchor-navigation-ex","theme-comscore","intopic-toc","tbfed-pagefooter"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy book.stolenzc.com 2021-2022"},"prism":{},"github":{"url":"https://github.com/stolenzc"},"intopic-toc":{"isCollapsed":true,"isScrollspyActive":true,"label":"目录","maxDepth":6,"mode":"nested","selector":".markdown-section h1, .markdown-section h2, .markdown-section h3, .markdown-section h4, .markdown-section h5, .markdown-section h6","visible":true},"splitter":{},"search-pro":{},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"anchor-navigation-ex":{"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"mode":"","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showGoTop":true,"showLevel":true},"theme-comscore":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"STOLENZC","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"NOTEBOOK","language":"zh-hans","links":{"sidebar":{"博客主页":"https://stolenzc.github.io/blog","JSON TOOLS":"https://stolenzc.github.io/tools/json"}},"gitbook":"*"},"file":{"path":"Project.md","mtime":"2022-03-27T15:39:57.168Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-03-27T15:40:42.265Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-intopic-toc/anchor.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-intopic-toc/gumshoe.polyfills.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-intopic-toc/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

